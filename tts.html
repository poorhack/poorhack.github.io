<!DOCTYPE html>
<html>
<head>
    <title>TTSç¤ºä¾‹</title>
</head>
<body>
    <textarea id="textInput" rows="4" cols="50">
        è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡å­—...
    </textarea><br>
    
    <label>è¯­é€Ÿ: <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1"></label>
    <label>éŸ³é«˜: <input type="range" id="pitch" min="0" max="2" step="0.1" value="1"></label>
    <label>éŸ³é‡: <input type="range" id="volume" min="0" max="1" step="0.1" value="1"></label><br>
    
    <select id="voiceSelect"></select><br>
    
    <button onclick="speak()">æœ—è¯»</button>
    <button onclick="pause()">æš‚åœ</button>
    <button onclick="resume()">æ¢å¤</button>
    <button onclick="stop()">åœæ­¢</button>
    <div id="tts-status"></div>
    <button onclick="checkAndSpeak()">æµ‹è¯•æœ—è¯»</button>

    <script>
        let synth = window.speechSynthesis;
        let voices = [];
        
        // åŠ è½½å¯ç”¨è¯­éŸ³
        function loadVoices() {
            voices = synth.getVoices();
            const select = document.getElementById('voiceSelect');
            select.innerHTML = '';
            
            voices.forEach(voice => {
                const option = document.createElement('option');
                option.value = voice.name;
                option.textContent = `${voice.name} (${voice.lang})`;
                select.appendChild(option);
            });
        }
        
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }
        
        function speak() {
            const text = document.getElementById('textInput').value;
            if (!text) return;
            
            synth.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = document.getElementById('rate').value;
            utterance.pitch = document.getElementById('pitch').value;
            utterance.volume = document.getElementById('volume').value;
            
            const selectedVoice = voices.find(
                voice => voice.name === document.getElementById('voiceSelect').value
            );
            if (selectedVoice) utterance.voice = selectedVoice;
            
            synth.speak(utterance);
        }
        
        function pause() { synth.pause(); }
        function resume() { synth.resume(); }
        function stop() { synth.cancel(); }
        
        // åˆå§‹åŒ–
        loadVoices();
        async function checkAndSpeak() {
            const statusEl = document.getElementById('tts-status');
            
            // åŸºç¡€æ£€æµ‹
            if (!('speechSynthesis' in window)) {
                statusEl.innerHTML = 'âŒ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ';
                return;
            }
            
            statusEl.innerHTML = 'ğŸ” æ£€æµ‹è®¾å¤‡æ”¯æŒ...';
            
            const synth = window.speechSynthesis;
            
            // ç­‰å¾…è¯­éŸ³åŠ è½½ï¼ˆç§»åŠ¨ç«¯éœ€è¦ï¼‰
            await new Promise(resolve => {
                if (synth.getVoices().length > 0) {
                    resolve();
                } else {
                    synth.onvoiceschanged = resolve;
                    // è¶…æ—¶å¤„ç†
                    setTimeout(resolve, 1500);
                }
            });
            
            const voices = synth.getVoices();
            
            if (voices.length === 0) {
                // å¯èƒ½æ˜¯ç§»åŠ¨ç«¯ï¼Œå°è¯•é™é»˜æœ—è¯»
                statusEl.innerHTML = 'ğŸ“± ä½¿ç”¨è®¾å¤‡é»˜è®¤è¯­éŸ³';
                const utterance = new SpeechSynthesisUtterance('æµ‹è¯•è¯­éŸ³');
                utterance.lang = 'zh-CN';
                utterance.onend = () => {
                    statusEl.innerHTML = 'âœ… æœ—è¯»å®Œæˆï¼ˆæ— å£°åˆ—è¡¨æ¨¡å¼ï¼‰';
                };
                synth.speak(utterance);
            } else {
                statusEl.innerHTML = `âœ… æ”¯æŒï¼Œæ‰¾åˆ°${voices.length}ä¸ªè¯­éŸ³`;
                // æ­£å¸¸ä½¿ç”¨
            }
        }
    </script>
</body>
</html>
